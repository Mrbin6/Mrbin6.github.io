<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Plupload使用指南</title>
    <!-- 首先需要引入plupload的源代码 -->
    <script src="plupload.full.min.js"></script>
    <style>
        #imgs_ul li,#imgs_ul li img{
            height:50px;
            width:50px;
        }
    </style>
</head>
<body>
    <!-- 这里我们只使用最基本的html结构：一个选择文件的按钮，一个开始上传文件的按钮(甚至该按钮也可以不要) -->
    <p>
        <button id="browse">选择文件</button>
        <button id="start_upload">开始上传</button>
    </p>
    <ul id="imgs_ul">

    </ul>
    <script>

    //实例化一个plupload上传对象
    var uploader = new plupload.Uploader({
        browse_button : 'browse', //触发文件选择对话框的按钮，为那个元素id
        url : 'upload.php', //服务器端的上传页面地址
        filters:{
            mime_types:[
                {title:"图片文件",extensions:"jpg,gif,png"}
            ]
        }
    });  
    uploader.init();
    uploader.bind('FilesAdded',function(uploader,files){
        for(var i=0,len=files.length;i<len;i++){
            var file_name=files[i].name;
            !function(i){
                previewImage(files[i],function(imgsrc){
                    $("#imgs_ul").append("<li><img src='"+imgsrc+"'/>");
                });
            }(i);
        }
    });
    function previewImage(file,callback){
        if(!file||!/image\//.test(file.type)) return;//确保文件真的是图片
        if(file.type=='image/gif'){
            var fr=new mOxie.FileReader();
            fr.onload=function(){
                callback(fr.result);
                fr.destroy();
                fr=null;
            }
            fr.read
        }

    }

    document.getElementById("start_upload").onclick=function(){
        uploader.start();
    };
    </script>
</body>
</html>