<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <title>拖动div的特效1</title>
  <script src="jquery-1.11.3.js"></script>
  <script src="jquery-ui.js"></script>
 </head>
 <style>
	li{
		display:block;
		list-style-type:none;
		height:25px;
		width:270px;
		border:1px solid black;
		padding:5px;
	}
	.bj_bigdiv{
		height:800px;
		width:1200px;
		border:1px solid black;
	}
	.bj_left_div,
	.bj_right_div{
		height:500px;
		width:300px;
		margin:20px 50px;
		float:left;
		border:1px solid black;
	}
	.bj_input{
		float:left;
		margin-top:50px;
		margin-left:10px;
		display:none;
	}
	.bj_input>textarea{
		resize:none;
		height:150px;
		width:200px; 
	}
 </style>
 <body>
 <div class="bj_bigdiv">
	<ul class="bj_left_div">
			<li id="input_type" draggable="true">我是输入框部件</li>
			<li id="image_type" draggable="true">我是图片部件</li>
	</ul>
	<ul class="bj_right_div">
		
	</ul>
	<div class="bj_input">
		<textarea id="input_area" value="这里可以输入文字"></textarea><br/>
		<button id="confirm">确  认</button>
	</div>
 </div>
 </body>
 <script>
	$(function(){
		var idNum=1;
		//源对象
		$(".bj_left_div>li").on("dragstart",function(event){
			event.originalEvent.dataTransfer.setData("Text",event.target.id);
		});
		//目标对象
		var $dest=$(".bj_right_div");
		$dest.on("dragover", function(event) {
			event.preventDefault();
			event.stopPropagation();
		});
		$dest.on("drop",function(event){
			event.preventDefault();
			event.stopPropagation();
			var df=event.originalEvent.dataTransfer;
			var data=df.getData("Text");
			var el=event.target;//目标对象
			var ctx=$(this)[0];//当前容器
			if(data==""){
				return false;
			}
			else{
				idNum++;
				var appended=false;//判断是否已经添加过了。防止在循环中反复添加
				do{
					var $item=$(document.createElement("li"));
					$item.attr("id","li"+idNum);
					$item.click(function(){//必须在生成li的时候加，否则事件触发不了
						$(".bj_input>textarea").attr("name",$item.attr("id"));
					});
					var html="";
					if(data=="input_type"){
						html="<input id='d1' class='bj_change_value' type='text' value='输入文本'/>";
					}
					else if(data=="image_type"){
						html="<img src='chrome.png'/>";
					}
					$item.html(html);
					if($(this).children().length>0){//目标有子元素，现在有也只能是li元素。
						if(el.nodeName=="LI"){
							if(el.nextElementSibling){
								el.parentNode.insertBefore($item.get(0),el.nextElementSibling);
							}else{
								ctx.appendChild($item.get(0));
							}
							appended=true;
						}else if(appended==false && $(el).hasClass("bj_right_div")){//目标就是最大的容器，拖到夹缝中也是这个
							ctx.appendChild($item.get(0));
						}
					}else{//目标没有li
						ctx.appendChild($item.get(0));
					}
				}while(el !== ctx && (el = el.parentNode));//为了防止放到li的元素的内部。
			}
		});
		$dest.sortable();//JQUERY UI sortable组件
	});
$(function(){
		
		$("#input_area").on("drop",function(event){//取消textarea框拖入东西的默认效果。
			event.preventDefault();
			event.stopPropagation();
		});

		$("#confirm").click(function(){//点击确定，将textarea中的文本放到对应的li中。
		var text=$("#input_area").val();
		if(text){
			var liId=$("#input_area").attr("name");	
			if(liId){
				$("#"+liId).html(text);
				}
			}
		});
		$(document).click(function(event){//点击
			if(event.target.id.slice(0,2)=="li"){
				$(".bj_input").show();
			}else if(event.target.id=="input_area"||event.target.id=="confirm"){
				//这里是点击了右部编辑框的输入框或者是按钮，什么也不干。
			}else{
				$(".bj_input").hide();
			}
		});
});
	
 </script>
</html>
